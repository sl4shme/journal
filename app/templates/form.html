<html><body>
<script>

  var catch_up = [{"date": "2020_01_10", "value": 0.5},
                  {"date": "2020_01_10", "value": 1},
                  {"date": "2020_01_10", "value": 0.5}]

  var exercise_model = {"Bike": ["km", "time"],
                        "Run": ["km", "time"],
                        "Climb": ["count", "time"]}

  var day = {}

  function add_exercise_fields(e){
    if (e.target.value in exercise_model){
      document.getElementById(e.target.parentElement.id + "_span").innerHTML = ""
      var fields = exercise_model[e.target.value]
      for(var field of fields) {
        var input = document.createElement("input")
        input.name = e.target.parentElement.id + "_" + field
        input.type = "text"
        input.placeholder = field
        document.getElementById(e.target.parentElement.id + "_span").appendChild(input)
      }
    }
  }

  function add_exercise() {
    var unique_name = "ex_" + Math.random().toString(36).substr(2, 9)
    var elem = document.createElement("p")
    elem.id = unique_name

    var input = document.createElement("input")
    input.name = unique_name + "_type"
    input.setAttribute("list", unique_name + "_type_list")
    input.placeholder = "Type"
    input.addEventListener('input', add_exercise_fields)
    elem.appendChild(input)

    var datalist = document.createElement("datalist")
    datalist.id = unique_name + "_type_list"
    for (type in exercise_model) {
      var option = document.createElement('option')
      option.value = type
      datalist.appendChild(option)
    }
    elem.appendChild(datalist)

    var span = document.createElement("span")
    span.id = unique_name + "_span"
    elem.appendChild(span)

    input = document.createElement("input")
    input.name = unique_name + "_location"
    input.type = "text"
    input.placeholder = "Location"
    elem.appendChild(input)

    input = document.createElement("textarea")
    input.name = unique_name + "_comment"
    input.placeholder = "Comment"
    elem.appendChild(input)

    var radio = document.createElement("input")
    radio.type = "radio"
    radio.id = unique_name + "_counts_0"
    radio.name = unique_name + "_counts"
    radio.value = "0"
    radio.checked = true
    var label = document.createElement("label")
    label.setAttribute("for", unique_name + "_counts_0")
    label.innerHTML = "0"
    elem.appendChild(radio)
    elem.appendChild(label)

    var radio = document.createElement("input")
    radio.type = "radio"
    radio.id = unique_name + "_counts_05"
    radio.name = unique_name + "_counts"
    radio.value = "0.5"
    var label = document.createElement("label")
    label.setAttribute("for", unique_name + "_counts_05")
    label.innerHTML = "1/2"
    elem.appendChild(radio)
    elem.appendChild(label)

    var radio = document.createElement("input")
    radio.type = "radio"
    radio.id = unique_name + "_counts_1"
    radio.name = unique_name + "_counts"
    radio.value = "1"
    var label = document.createElement("label")
    label.setAttribute("for", unique_name + "_counts_1")
    label.innerHTML = "1"
    elem.appendChild(radio)
    elem.appendChild(label)

    var input = document.createElement("input")
    input.name = unique_name + "_catch_up"
    input.setAttribute("list", unique_name + "_catch_up")
    input.placeholder = "Catch up"
    elem.appendChild(input)

    var datalist = document.createElement("datalist")
    datalist.id = unique_name + "_catch_up"
    for(var catch_up_elem of catch_up) {
      var option = document.createElement('option')
      option.value = catch_up_elem["date"] + " (" + catch_up_elem["value"] + ")"
      datalist.appendChild(option)
    }
    elem.appendChild(datalist)

    var button = document.createElement("button")
    button.type = "button"
    button.innerHTML = "-"
    button.addEventListener("click", function(){ document.getElementById(unique_name).remove() })
    elem.appendChild(button)

    document.getElementById("exercises").appendChild(elem)
  }

</script>

<div id="page">
  <form action="" method="post">
    <p>
      <button type="button" onclick="window.location.href = '/?date={{ day.date_str }}&minus=true';"><</button>
      <input id="date_field" type="date" name="date" value="{{ day.date_str }}" onchange="window.location.href = '/?date=' + document.getElementById('date_field').value">
      <button type="button" onclick="window.location.href = '/?date={{ day.date_str }}&plus=true';">></button>
    </p>

    <p>
      <label for="recap">Recap</label><br>
      <textarea id="recap" name="recap"></textarea>
    </p>

    <p>
      <label for="weight">Weight</label>
      <input type="text" id="weight" name="weight"></input>
      Happiness
      <label for="happiness_1">1</label>
      <input type="radio" id="happiness_1" name="happiness" value="1"></input>
      <label for="happiness_2">2</label>
      <input type="radio" id="happiness_2" name="happiness" value="2"></input>
      <label for="happiness_3">3</label>
      <input type="radio" id="happiness_3" name="happiness" value="3"></input>
      <label for="happiness_4">4</label>
      <input type="radio" id="happiness_4" name="happiness" value="4"></input>
      <label for="happiness_5">5</label>
      <input type="radio" id="happiness_5" name="happiness" value="5"></input>
    </p>

    <p>Exercises
      <div id="exercises"></div>
      <button type="button" onclick="add_exercise()">+</button>
    </p>

    <p><input id="submit" name="submit" type="submit" value="Save"></p>
  </form>
</div>
</body></html>
